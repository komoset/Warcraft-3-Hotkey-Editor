<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Warcraft 3 Hotkey Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a2a2f, #2a4a5f);
            color: #b0e0e6;
            text-align: center;
            padding: 20px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        h1 {
            color: #40c4ff;
            text-shadow: 2px 2px 4px rgba(0, 64, 128, 0.5), 0 0 10px rgba(64, 196, 255, 0.7);
            font-size: 32px;
            margin-bottom: 20px;
        }
        .container {
            position: relative;
            width: 800px;
            height: 290px;
            margin: 30px auto;
            display: flex;
            border: 2px solid rgba(74, 105, 115, 0.5);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            background: rgba(26, 42, 47, 0.8);
            padding: 10px;
        }
        .inventory-grid-container {
            position: relative;
            width: 150px;
            height: 290px;
            background-image: url('inventory.png');
            background-size: 150px 249px;
            background-position: center;
            background-repeat: no-repeat;
            border: 1px solid rgba(74, 105, 115, 0.7);
            border-radius: 8px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(2, 64px);
            grid-template-rows: repeat(3, 64px);
            grid-column-gap: 8px;
            grid-row-gap: 4px;
            position: absolute;
            top: 64px;
            left: 6px;
            width: 138px;
            height: 198px;
        }
        .grid-container {
            position: relative;
            width: 340px;
            height: 290px;
            background-image: url('hotkeys.png');
            background-size: cover;
            background-position: center;
            margin-left: 20px;
            border: 1px solid rgba(74, 105, 115, 0.7);
            border-radius: 8px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 79px);
            grid-template-rows: repeat(3, 79px);
            grid-gap: 0;
            position: absolute;
            top: 53px;
            left: 11px;
            width: 316px;
            height: 237px;
        }
        .slot {
            position: relative;
        }
        button {
            width: 64px;
            height: 64px;
            font-size: 25px;
            background-color: rgba(74, 105, 115, 0.0);
            color: #b0e0e6;
            border: 2px solid #4a6973;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            text-shadow: 1px 1px 2px #0a1417;
        }
        button:hover {
            background-color: rgba(64, 196, 255, 0.5);
            border-color: #40c4ff;
            box-shadow: 0 0 8px rgba(64, 196, 255, 0.7);
            color: #e0f7fa;
        }
        .grid button {
            width: 79px;
            height: 79px;
        }
        .selected {
            color: #40c4ff;
            border-color: #40c4ff;
        }
        .quickcast-label {
            position: absolute;
            bottom: 5px;
            right: 5px;
            font-size: 10px;
            color: #b0e0e6;
            display: flex;
            align-items: center;
            text-shadow: 1px 1px 2px #0a1417;
        }
        .quickcast {
            margin-left: 3px;
        }
        .controls {
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            margin-left: 20px;
        }
        .controls button {
            padding: 5px 20px;
            width: 220px;
            font-size: 20px;
            background: linear-gradient(45deg, #4a6973, #406f80);
            color: #b0e0e6;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            margin: 5px 0;
        }
        .controls button:hover {
            background: linear-gradient(45deg, #40c4ff, #2a8ab7);
            color: #1a2a2f;
            box-shadow: 0 4px 12px rgba(64, 196, 255, 0.4);
        }
        p {
            font-size: 16px;
            color: #80deea;
            margin: 10px 0;
            text-shadow: 1px 1px 2px #0a1417;
        }
        #warning {
            color: #ff5555;
            font-size: 16px;
            display: none;
            text-shadow: 1px 1px 2px #0a1417;
        }
        #dropZone {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 42, 47, 0.9);
            border: 2px dashed #40c4ff;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        #dropBox {
            background: #4a6973;
            padding: 20px;
            border-radius: 10px;
            color: #e0f7fa;
            font-size: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Warcraft 3 Hotkey Editor</h1>
    <div class="container">
        <div class="inventory-grid-container">
            <div class="inventory-grid" id="inventoryHotkeyGrid">
                <div class="slot">
                    <button data-slot="0">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="0" class="inventory-quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="1">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="1" class="inventory-quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="2">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="2" class="inventory-quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="3">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="3" class="inventory-quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="4">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="4" class="inventory-quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="5">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="5" class="inventory-quickcast"></label>
                    </button>
                </div>
            </div>
        </div>
        <div class="grid-container">
            <div class="grid" id="hotkeyGrid">
                <div class="slot">
                    <button data-slot="00">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="00" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="01">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="01" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="02">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="02" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="03">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="03" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="10">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="10" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="11">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="11" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="12">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="12" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="13">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="13" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="20">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="20" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="21">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="21" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="22">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="22" class="quickcast"></label>
                    </button>
                </div>
                <div class="slot">
                    <button data-slot="23">
                        <label class="quickcast-label">QC<input type="checkbox" data-slot="23" class="quickcast"></label>
                    </button>
                </div>
            </div>
        </div>
        <div class="controls">
            <button onclick="saveFile()">Save Hotkeys</button>
            <button onclick="resetHotkeys()">Reset Hotkeys</button>
            <button onclick="toggleQuickcastAll()">Quickcast All</button>
            <button onclick="document.getElementById('fileInput').click()">Load File<br>(Or Drag And drop)</button>
            <input type="file" id="fileInput" style="display: none;" accept=".txt" onchange="loadFile(event)">
        </div>
    </div>
    <p>Click a slot, then press a key to set the hotkey.</p>
    <p id="warning">Warning: Multiple slots are bound to the same key.</p>
    <div id="dropZone">
        <div id="dropBox">Drop your War3Preferences.txt file here</div>
    </div>
    <script>
        let selectedSlot = null;
        const hotkeys = {};
        const inventoryHotkeys = {};
        let unchangedFileData = "";
        const commandbarSlotOrder = [
            "00", "01", "02", "03",
            "10", "11", "12", "13",
            "20", "21", "22", "23"
        ];
        const inventorySlotOrder = ["0", "1", "2", "3", "4", "5"];
        const buttons = document.querySelectorAll(".grid button");
        const inventoryButtons = document.querySelectorAll(".inventory-grid button");
        const quickcastCheckboxes = document.querySelectorAll(".quickcast");
        const inventoryQuickcastCheckboxes = document.querySelectorAll(".inventory-quickcast");
        const warningText = document.getElementById("warning");
        const dropZone = document.getElementById("dropZone");

        buttons.forEach(button => {
            button.addEventListener("click", (event) => {
                if (event.target.type !== "checkbox") {
                    buttons.forEach(btn => btn.classList.remove("selected"));
                    inventoryButtons.forEach(btn => btn.classList.remove("selected"));
                    button.classList.add("selected");
                    selectedSlot = button.getAttribute("data-slot");
                }
            });
        });

        inventoryButtons.forEach(button => {
            button.addEventListener("click", (event) => {
                if (event.target.type !== "checkbox") {
                    buttons.forEach(btn => btn.classList.remove("selected"));
                    inventoryButtons.forEach(btn => btn.classList.remove("selected"));
                    button.classList.add("selected");
                    selectedSlot = button.getAttribute("data-slot");
                }
            });
        });

        function checkDuplicates() {
            const allHotkeys = { ...hotkeys, ...inventoryHotkeys };
            const values = Object.values(allHotkeys);
            const hasDuplicates = values.some((val, i) => values.indexOf(val) !== i && val !== undefined);
            warningText.style.display = hasDuplicates ? "block" : "none";
        }

        document.addEventListener("keydown", (event) => {
            if (selectedSlot !== null) {
                const keyCode = event.keyCode;
                const button = document.querySelector(`button[data-slot="${selectedSlot}"]`);
                if (commandbarSlotOrder.includes(selectedSlot)) {
                    hotkeys[selectedSlot] = keyCode;
                } else if (inventorySlotOrder.includes(selectedSlot)) {
                    inventoryHotkeys[selectedSlot] = keyCode;
                }
                button.childNodes[0].textContent = event.key.toUpperCase();
                selectedSlot = null;
                buttons.forEach(btn => btn.classList.remove("selected"));
                inventoryButtons.forEach(btn => btn.classList.remove("selected"));
                checkDuplicates();
            }
        });

        function loadFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            processFile(file);
            dropZone.style.display = "none";
        }

        function processFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const lines = content.split('\n');
                let currentSection = null;
                let sectionContent = [];
                unchangedFileData = "";

                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine.startsWith('[')) {
                        if (currentSection) {
                            if (!currentSection.match(/^\[(Commandbar Hotkeys|Inventory Hotkeys)/)) {
                                unchangedFileData += sectionContent.join('\n') + '\n';
                            }
                            sectionContent = [];
                        }
                        currentSection = trimmedLine;
                        sectionContent.push(line);
                    } else if (trimmedLine && currentSection) {
                        sectionContent.push(line);
                        if (currentSection.match(/^\[Commandbar Hotkeys (\d{2})\]/)) {
                            const slot = currentSection.match(/\d{2}/)[0];
                            if (trimmedLine.startsWith('Hotkey=')) {
                                const hotkey = parseInt(trimmedLine.split('=')[1]);
                                hotkeys[slot] = hotkey;
                                const button = document.querySelector(`button[data-slot="${slot}"]`);
                                button.childNodes[0].textContent = String.fromCharCode(hotkey).toUpperCase();
                            } else if (trimmedLine.startsWith('QuickCast=')) {
                                const quickcast = parseInt(trimmedLine.split('=')[1]);
                                document.querySelector(`input[data-slot="${slot}"]`).checked = quickcast === 1;
                            }
                        } else if (currentSection.match(/^\[Inventory Hotkeys (\d)\]/)) {
                            const slot = currentSection.match(/\d/)[0];
                            if (trimmedLine.startsWith('Hotkey=')) {
                                const hotkey = parseInt(trimmedLine.split('=')[1]);
                                inventoryHotkeys[slot] = hotkey;
                                const button = document.querySelector(`button[data-slot="${slot}"]`);
                                button.childNodes[0].textContent = String.fromCharCode(hotkey).toUpperCase();
                            } else if (trimmedLine.startsWith('QuickCast=')) {
                                const quickcast = parseInt(trimmedLine.split('=')[1]);
                                document.querySelector(`input[data-slot="${slot}"]`).checked = quickcast === 1;
                            }
                        }
                    }
                });

                if (currentSection && !currentSection.match(/^\[(Commandbar Hotkeys|Inventory Hotkeys)/)) {
                    unchangedFileData += sectionContent.join('\n') + '\n';
                }
                checkDuplicates();
            };
            reader.readAsText(file);
        }

        function saveFile() {
            let fileContent = "";
            commandbarSlotOrder.forEach(slot => {
                if (hotkeys[slot]) {
                    const quickcast = document.querySelector(`input[data-slot="${slot}"]`).checked ? 1 : 0;
                    fileContent += `[Commandbar Hotkeys ${slot}]\n`;
                    fileContent += `HeroOnly=0\n`;
                    fileContent += `Hotkey=${hotkeys[slot]}\n`;
                    fileContent += `MetaKeyState=0\n`;
                    fileContent += `QuickCast=${quickcast}\n\n`;
                }
            });
            inventorySlotOrder.forEach(slot => {
                if (inventoryHotkeys[slot]) {
                    const quickcast = document.querySelector(`input[data-slot="${slot}"]`).checked ? 1 : 0;
                    fileContent += `[Inventory Hotkeys ${slot}]\n`;
                    fileContent += `HeroOnly=0\n`;
                    fileContent += `Hotkey=${inventoryHotkeys[slot]}\n`;
                    fileContent += `MetaKeyState=0\n`;
                    fileContent += `QuickCast=${quickcast}\n\n`;
                }
            });
            fileContent += unchangedFileData.trim();
            const blob = new Blob([fileContent], { type: "text/plain" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "War3Preferences.txt";
            link.click();
        }

        function resetHotkeys() {
            for (let slot in hotkeys) delete hotkeys[slot];
            for (let slot in inventoryHotkeys) delete inventoryHotkeys[slot];
            buttons.forEach(button => {
                button.childNodes[0].textContent = "";
                button.classList.remove("selected");
            });
            inventoryButtons.forEach(button => {
                button.childNodes[0].textContent = "";
                button.classList.remove("selected");
            });
            quickcastCheckboxes.forEach(checkbox => checkbox.checked = false);
            inventoryQuickcastCheckboxes.forEach(checkbox => checkbox.checked = false);
            selectedSlot = null;
            checkDuplicates();
        }

        function toggleQuickcastAll() {
            const allChecked = Array.from(quickcastCheckboxes).every(cb => cb.checked) &&
                              Array.from(inventoryQuickcastCheckboxes).every(cb => cb.checked);
            quickcastCheckboxes.forEach(checkbox => checkbox.checked = !allChecked);
            inventoryQuickcastCheckboxes.forEach(checkbox => checkbox.checked = !allChecked);
        }

        document.addEventListener("dragover", (event) => {
            event.preventDefault();
            dropZone.style.display = "flex";
        });

        document.addEventListener("dragleave", (event) => {
            event.preventDefault();
            dropZone.style.display = "none";
        });

        document.addEventListener("drop", (event) => {
            event.preventDefault();
            dropZone.style.display = "none";
            const file = event.dataTransfer.files[0];
            if (file && file.name.endsWith(".txt")) {
                processFile(file);
            }
        });
    </script>
</body>
</html>